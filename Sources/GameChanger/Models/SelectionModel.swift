// Handles ALL selection logic
// Complete implementation with selection handling 